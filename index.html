<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIVA Chronos Pro 2025</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/jpg" href="image_0.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary: #1e40af;
            --accent: #3b82f6;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --vacation: #0d9488;
            --border: #e2e8f0;
        }

        body { 
            font-family: 'Inter', -apple-system, system-ui, sans-serif; 
            background: #cbd5e1; margin: 0; padding: 0;
            display: flex; justify-content: center; height: 100dvh; overflow: hidden;
        }

        .app-container { 
            max-width: 500px; width: 100%; background: var(--bg); 
            display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(0,0,0,0.15);
        }

        /* --- Header --- */
        header {
            background: var(--primary); color: white; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); z-index: 20;
        }
        .brand { display: flex; align-items: center; }
        .logo { height: 42px; width: 42px; object-fit: contain; background: white; border-radius: 10px; padding: 3px; margin-right: 12px; }
        .brand h1 { margin: 0; font-size: 1.2rem; font-weight: 800; letter-spacing: -0.5px; }

        .v-toggle {
            background: rgba(255,255,255,0.2); padding: 7px 14px; border-radius: 25px;
            font-size: 11px; cursor: pointer; border: 1px solid rgba(255,255,255,0.3); font-weight: 700;
        }

        /* --- Lista de Tareas --- */
        .main-list { flex: 1; overflow-y: auto; padding: 20px; }
        .list-title { font-size: 0.75rem; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 1px; }

        .task-card { 
            background: var(--card); padding: 16px; border-radius: 15px; margin-bottom: 12px;
            border-left: 6px solid var(--accent); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            animation: slideUp 0.3s ease;
        }
        .vencida { opacity: 0.6; background: #f1f5f9; border-left-color: #94a3b8 !important; }

        /* --- Formulario de Control --- */
        .control-panel { 
            background: white; padding: 20px; border-top: 1px solid var(--border);
            box-shadow: 0 -10px 20px rgba(0,0,0,0.03);
        }
        .input-box { width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        input, select, textarea {
            width: 100%; padding: 14px; border: 1.5px solid var(--border);
            border-radius: 12px; font-size: 16px; box-sizing: border-box; font-family: inherit;
            transition: border-color 0.2s;
        }
        input:focus { outline: none; border-color: var(--primary); }

        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }

        .btn { border: none; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-main { background: var(--primary); color: white; width: 100%; padding: 16px; font-size: 16px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2); }
        .btn-main:active { transform: scale(0.97); }

        .tool-bar { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-tool { background: #f1f5f9; color: #475569; flex: 2; font-size: 12px; padding: 12px 5px; border: 1.5px solid var(--border); }
        .btn-red { background: #fee2e2; color: #dc2626; flex: 1; border: 1.5px solid #fecaca; }

        .footer-credits { text-align: center; font-size: 11px; color: #94a3b8; margin-top: 15px; }

        /* Estilos de Modal */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 100%; max-width: 380px; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 380px) { .btn-tool { flex: 1 1 100%; } }
    </style>
</head>
<body>

<div class="app-container">
    <header id="topHeader">
        <div class="brand">
            <img src="logo aiva.jpg" alt="Logo AIVA" class="logo">
            <h1>AIVA Chronos</h1>
        </div>
        <div id="vacationBtn" class="v-toggle" onclick="toggleVacation()">üíº Modo Oficina</div>
    </header>

    <main class="main-list" id="eventList"></main>

    <footer class="control-panel">
        <div class="input-box">
            <input type="text" id="taskName" placeholder="¬øQu√© hay que hacer?">
        </div>
        <div class="input-box">
            <textarea id="taskDesc" placeholder="Detalles u observaciones..." rows="1"></textarea>
        </div>
        <div class="grid-inputs">
            <select id="taskCat">
                <option value="trabajo">üíº Trabajo</option>
                <option value="urgente">üî• Urgente</option>
                <option value="personal">üè† Personal</option>
            </select>
            <input type="datetime-local" id="taskDate">
        </div>
        
        <button class="btn btn-main" onclick="addEvent()">‚ûï Agendar Tarea</button>

        <div class="tool-bar">
            <button class="btn btn-tool" onclick="downloadCSV()">üì• Descargar Agenda</button>
            <button class="btn btn-tool" onclick="document.getElementById('csvIn').click()">üì§ Cargar Agenda</button>
            <button class="btn btn-red" onclick="exportPDF()">üìÑ PDF</button>
        </div>
        <input type="file" id="csvIn" style="display:none" accept=".csv" onchange="importCSV(event)">
        
        <p class="footer-credits">Desarrollado por <strong>AIVA Academia</strong> &copy; 2025</p>
    </footer>
</div>

<audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>
<img id="pdfLogo" src="logo aiva.jpg" style="display:none;">

<script>
    const { jsPDF } = window.jspdf;
    const sound = document.getElementById('alertSound');
    let vMode = localStorage.getItem('vMode') === 'true';

    document.addEventListener('DOMContentLoaded', () => {
        syncVacation();
        cleanOldTasks();
        render();
        setInterval(checkAlarms, 10000);
    });

    function toggleVacation() {
        vMode = !vMode;
        localStorage.setItem('vMode', vMode);
        syncVacation();
    }

    function syncVacation() {
        const btn = document.getElementById('vacationBtn');
        const header = document.getElementById('topHeader');
        header.style.background = vMode ? 'var(--vacation)' : 'var(--primary)';
        btn.innerHTML = vMode ? 'üå¥ Modo Vacaciones' : 'üíº Modo Oficina';
    }

    function addEvent() {
        const name = document.getElementById('taskName').value;
        const desc = document.getElementById('taskDesc').value;
        const date = document.getElementById('taskDate').value;
        const cat = document.getElementById('taskCat').value;

        if (!name || !date) return alert("Completa t√≠tulo y fecha.");

        sound.play().then(() => sound.pause()).catch(()=>{});

        const data = JSON.parse(localStorage.getItem('aiva_tasks')) || [];
        data.push({ id: Date.now(), name, desc, date, cat, alerted: false });
        localStorage.setItem('aiva_tasks', JSON.stringify(data));
        
        document.getElementById('taskName').value = '';
        document.getElementById('taskDesc').value = '';
        render();
    }

    function render() {
        const list = document.getElementById('eventList');
        const data = JSON.parse(localStorage.getItem('aiva_tasks')) || [];
        const now = new Date().getTime();
        list.innerHTML = '';

        const upcoming = data.filter(e => new Date(e.date).getTime() >= now).sort((a,b) => new Date(a.date) - new Date(b.date));
        const past = data.filter(e => new Date(e.date).getTime() < now).sort((a,b) => new Date(b.date) - new Date(a.date));

        if(upcoming.length) {
            list.innerHTML += '<div class="list-title">Pr√≥ximos Compromisos</div>';
            upcoming.forEach(e => list.innerHTML += taskHTML(e, false));
        }
        if(past.length) {
            list.innerHTML += '<div class="list-title">Tareas de Hoy</div>';
            past.forEach(e => list.innerHTML += taskHTML(e, true));
        }
    }

    function taskHTML(e, isPast) {
        const time = new Date(e.date).toLocaleString([], {day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit'});
        return `
            <div class="task-card ${isPast?'vencida':''}">
                <div style="flex:1">
                    <small style="color:var(--primary); font-weight:bold;">${time}</small><br>
                    <strong>${e.name}</strong>
                </div>
                <button onclick="remove(${e.id})" style="background:none; border:none; color:#ef4444; font-size:20px; cursor:pointer;">‚úï</button>
            </div>`;
    }

    function checkAlarms() {
        if(vMode) return;
        const data = JSON.parse(localStorage.getItem('aiva_tasks')) || [];
        const now = new Date().getTime();
        let updated = false;

        data.forEach(e => {
            if (now >= new Date(e.date).getTime() && !e.alerted) {
                sound.play(); alert("‚è∞ AIVA: " + e.name);
                e.alerted = true; updated = true;
            }
        });

        if (updated) { localStorage.setItem('aiva_tasks', JSON.stringify(data)); render(); }
    }

    function remove(id) {
        if(!confirm("¬øEliminar tarea?")) return;
        let data = JSON.parse(localStorage.getItem('aiva_tasks')).filter(e => e.id != id);
        localStorage.setItem('aiva_tasks', JSON.stringify(data));
        render();
    }

    function downloadCSV() {
        const data = JSON.parse(localStorage.getItem('aiva_tasks')) || [];
        let csv = "id,nombre,descripcion,fecha,categoria,alertado\n";
        data.forEach(e => csv += `${e.id},"${e.name}","${e.desc||''}",${e.date},${e.cat},${e.alerted}\n`);
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "Agenda_AIVA_Elite.csv"; a.click();
    }

    function importCSV(ev) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const lines = e.target.result.split('\n').slice(1);
            const newData = lines.filter(l => l.trim()).map(l => {
                const p = l.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                return { id: p[0], name: p[1].replace(/"/g,''), desc: p[2].replace(/"/g,''), date: p[3], cat: p[4], alerted: p[5]==='true' };
            });
            localStorage.setItem('aiva_tasks', JSON.stringify(newData)); render(); alert("Agenda cargada.");
        };
        reader.readAsText(ev.target.files[0]);
    }

    function exportPDF() {
        const data = JSON.parse(localStorage.getItem('aiva_tasks')) || [];
        const doc = new jsPDF();
        doc.addImage(document.getElementById('pdfLogo'), 'JPG', 15, 12, 25, 25);
        doc.setFontSize(18); doc.text("REPORTE AIVA CHRONOS", 45, 25);
        let y = 50; data.forEach((e, i) => { doc.text(`${i+1}. [${e.date}] ${e.name}`, 20, y); y += 10; });
        doc.save("Reporte_Agenda_AIVA.pdf");
    }

    function cleanOldTasks() { 
        let data = JSON.parse(localStorage.getItem('aiva_tasks')) || [];
        const now = new Date().getTime(), day = 86400000;
        const clean = data.filter(e => (now - new Date(e.date).getTime()) < day);
        localStorage.setItem('aiva_tasks', JSON.stringify(clean));
    }
</script>
</body>
</html>

